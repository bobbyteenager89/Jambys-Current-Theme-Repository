{% assign product = section.settings.product %}
{% assign product = all_products[product] %}
{% assign current_variant = product.selected_or_first_available_variant %}

{% assign product_type = product.type | handleize %}

{% if product.type == 'House Hoodie' %}
  {% assign product_type = 'House Hoodies' | handleize %}
{% endif %}
{% if product.type == 'JamTee' %}
  {% assign product_type = 'JamTees' | handleize %}
{% endif %}
{% assign has_product_switcher = false %}
{% if product.type == 'Double Cozy Cloak' or product.type == 'Cozy Cloak' %}
  {% assign has_product_switcher = true %}
{% endif %}

{% assign color_collection = collections[product_type].products | where: 'type', product.type %}


<div 
  class="bundle-top-product top-product-short js-top-short builder-panel {% if section.settings.mobile_sticky_add %}sticky{% endif %}"
  data-apparel-type="bottom" 
  data-apparel-length="short"
>
  <div class="product" data-component="product" data-selected-variant="{{current_variant.id}}">
    
    <div class="pair-text pair-text-short">{{section.settings.top_text}}</div>
    <p class="guarantee">{{section.settings.guarantee}}</p>
    <div class="product-selections">
      <div class="product-colors">
        {% assign collection = collections[section.settings.collection] %}
        <div class="color-options">
          {% comment %}
          {% render 'bundle-product-colorways', product: product, collection: collection  %}
          {% endcomment %}
          {% comment %}
          Addison Applications color swacthes 02/20
          {% endcomment %}
          {% if color_collection %}
          <div><span class="bundle-color h2 js-option-color-txt">{{ product_title }}</span></div>
          <div class='product-options-wrapper'>
            <div class='fieldset flex'>
              <div class='legend flex'>
                <div class='legend-label'>
                  Color
                </div>
              </div>
              <div class='flex flex-col'>
                <ul class="product-color-swatches product-colorways">
                {% for collection_product in color_collection %}
                  {% unless collection_product.compare_at_price %}
                  {% if collection_product.metafields.product.color %}
                  <li {% if collection_product.id == product.id %} class="active"{% endif %} 
                      data-color-swatch="{{ collection_product.metafields.product.color }}" 
                      data-product-id-swatch="{{ collection_product.id }}"
                      data-js-product-handle="{{ collection_product.handle }}"
                      data-js-product-id="{{ collection_product.id }}"
                      data-js-product-type="{{ collection_product.type }}"
                      data-js-product-title="{{ collection_product.title }}"
                      data-js-product-feat-img="{{ collection_product.featured_image | image_url }}"
                      {% if collection_product.handle == section.settings.product %}
                      data-is-selected
                      {% endif %}>
                  </li>
                  <script id="{{collection_product.handle}}-{{collection_product.id}}-variants-details" data-product="{{collection_product.handle}}" type="text/plain">
                    {
                      {% for variant in collection_product.variants %}
                        "{{variant.title}}": {
                          "variantId": {{variant.id}},
                          "price": {{variant.price}},
                          "sku": "{{variant.sku}}",
                          "available": {{variant.available}}
                        } {% unless forloop.last %},{% endunless %}
                      {% endfor %}
                    }
                  </script>
                  <script id="{{collection_product.handle}}-{{collection_product.id}}-size-mockup" type="text/html">
                    {% render 'builder-product-options', product: collection_product %}
                  </script>
                  <script id="{{collection_product.handle}}-{{collection_product.id}}-gallery-mockup" type="text/html">
                    {% render 'builder-images-slider', product: collection_product %}
                  </script>
                  {% endif %}
                  {% endunless %}
                {% endfor %}
                </ul>
              </div>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
      <div class="product-size">
        {% render 'bundle-product-options', product: product %}
         {% include 'builder-size-guide-bottoms' %}
      </div>
    </div>
    <button class="button js-to-choose-bottom to-choose-bottom {% if section.settings.mobile_sticky_add %}sticky{% endif %}" disabled="disabled">
      <span class="ato">
        <img src="{{'icon-button-plus.svg' | file_url}}" alt="plus icon" /> 
        <span class="choose-bottom-txt">Add to Selection</span>
      </span>
      <span style="white-space: nowrap;">
        <span class="current-bundle-qty js-current-qty">0</span>
        <span class="total-bundle-qty js-bundle-qty">0</span>
      </span>
    </button>
  </div>
</div>